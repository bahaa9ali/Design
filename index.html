<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تعديل الصور بالأرقام</title>
<style>
  body { font-family: 'Tahoma', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 20px; }
  canvas { border: 1px solid #ccc; margin-top: 10px; cursor: grab; }
  .controls { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
  input, select, button { padding: 5px; font-size: 16px; }
  #preview { margin-top: 20px; display: grid; gap: 10px; grid-template-columns: repeat(3, 1fr); }
  #preview canvas { border: 1px solid #aaa; width: 100%; }
</style>
</head>
<body>

<h2>تطبيق تعديل الصور بالأرقام مع معاينة A4</h2>

<div class="controls">
  <input type="file" id="imageInput" accept="image/*">
  <input type="number" id="startNumber" placeholder="الرقم الأول" min="1" value="1">
  <input type="number" id="endNumber" placeholder="الرقم الأخير" min="1" value="10">
  <input type="color" id="colorInput" value="#ff0000">
  <select id="fontSelect">
    <option value="Meri">Meri</option>
    <option value="Arial">Arial</option>
    <option value="Tahoma">Tahoma</option>
  </select>
  <input type="number" id="fontSize" placeholder="حجم الخط" value="40">
  <button id="addNumber">أضف الرقم</button>
  <button id="previewButton">عرض المعاينة</button>
  <button id="printButton">طباعة</button>
</div>

<canvas id="canvas" width="800" height="600"></canvas>
<div id="preview"></div>

<script>
let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');
let img = new Image();
let numbers = [];
let selectedNumber = null;
let offsetX, offsetY;

// تحميل الصورة
document.getElementById('imageInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = event => {
            img.src = event.target.result;
            img.onload = () => draw();
        }
        reader.readAsDataURL(file);
    }
});

// إضافة الرقم (يمكن تحريكه)
document.getElementById('addNumber').addEventListener('click', () => {
    const color = document.getElementById('colorInput').value;
    const font = document.getElementById('fontSelect').value;
    const size = parseInt(document.getElementById('fontSize').value);
    numbers.push({x: 50, y: 50, color, font, size});
    draw();
});

// رسم الصورة والأرقام
function draw(number=null){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(img.src) ctx.drawImage(img,0,0,canvas.width,canvas.height);
    numbers.forEach(n => {
        ctx.fillStyle = n.color;
        ctx.font = `${n.size}px ${n.font}`;
        ctx.fillText(number!==null ? number : '', n.x, n.y);
    });
}

// سحب الرقم
canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;
    selectedNumber = null;
    for(let i = numbers.length-1;i>=0;i--){
        let n = numbers[i];
        ctx.font = `${n.size}px ${n.font}`;
        let width = ctx.measureText('0').width;
        let height = n.size;
        if(mx >= n.x && mx <= n.x + width && my <= n.y && my >= n.y - height){
            selectedNumber = n;
            offsetX = mx - n.x;
            offsetY = my - n.y;
            break;
        }
    }
});
canvas.addEventListener('mousemove', e => {
    if(selectedNumber){
        const rect = canvas.getBoundingClientRect();
        selectedNumber.x = e.clientX - rect.left - offsetX;
        selectedNumber.y = e.clientY - rect.top - offsetY;
        draw();
    }
});
canvas.addEventListener('mouseup', ()=> selectedNumber=null);
canvas.addEventListener('mouseout', ()=> selectedNumber=null);

// عرض المعاينة
document.getElementById('previewButton').addEventListener('click', () => {
    const start = parseInt(document.getElementById('startNumber').value);
    const end = parseInt(document.getElementById('endNumber').value);
    if(isNaN(start) || isNaN(end) || start > end) return alert("أدخل أرقام صحيحة");

    const previewDiv = document.getElementById('preview');
    previewDiv.innerHTML = '';
    for(let i=start;i<=end;i++){
        let tempCanvas = document.createElement('canvas');
        tempCanvas.width = 250;
        tempCanvas.height = 180;
        let tempCtx = tempCanvas.getContext('2d');
        tempCtx.drawImage(img,0,0,tempCanvas.width,tempCanvas.height);
        numbers.forEach(n=>{
            tempCtx.fillStyle = n.color;
            tempCtx.font = `${n.size}px ${n.font}`;
            tempCtx.fillText(i,n.x/800*tempCanvas.width,n.y/600*tempCanvas.height);
        });
        previewDiv.appendChild(tempCanvas);
    }
});

// طباعة المعاينة
document.getElementById('printButton').addEventListener('click', () => {
    window.print();
});
</script>

</body>
</html>
