<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شبكة22 الصور بالأرقام المتسلسلة</title>
<style>
body { font-family: 'Tahoma', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 20px; }
.controls { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; }
input, select, button, label { padding: 5px; font-size: 16px; }
#preview { margin-top: 20px; width:210mm; height:297mm; border:1px solid #000; position: relative; background:#fff; overflow:hidden; display:flex; flex-wrap:wrap; justify-content:flex-start; align-content:flex-start; }
#preview canvas { display:block; cursor: grab; }
</style>
</head>
<body>

<h2>شبكة الصور بالأرقام المتسلسلة</h2>

<div class="controls">
  <input type="file" id="imageInput" accept="image/*">
  <input type="number" id="startNumber" placeholder="الرقم الأول" value="1" min="1">
  <input type="number" id="columns" placeholder="عدد الأعمدة" value="3" min="1">
  <input type="number" id="rows" placeholder="عدد الصفوف" value="3" min="1">
  <input type="number" id="hSpacing" placeholder="المسافة الأفقية" value="10">
  <input type="number" id="vSpacing" placeholder="المسافة العمودية" value="10">
  <input type="color" id="colorInput" value="#ff0000">
  <select id="fontSelect">
    <option value="Meri">Meri</option>
    <option value="Arial">Arial</option>
    <option value="Tahoma">Tahoma</option>
  </select>
  <input type="number" id="fontSize" placeholder="حجم الرقم" value="40">
  <button id="addNumberButton">إضافة الرقم و عرض الشبكة</button>
  <button id="printButton">طباعة</button>
</div>

<script>
// تحويل الرقم للعربية
function toArabicNumber(num){
    const arabicNums = ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩'];
    return num.toString().split('').map(d => arabicNums[d]||d).join('');
}

let img = new Image();
let offsetX = 0, offsetY = 0;

// تحميل الصورة
document.getElementById('imageInput').addEventListener('change', e => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = event => { img.src = event.target.result; }
        reader.readAsDataURL(file);
    }
});

document.getElementById('addNumberButton').addEventListener('click', ()=>{
    const startNum = parseInt(document.getElementById('startNumber').value);
    const cols = parseInt(document.getElementById('columns').value);
    const rows = parseInt(document.getElementById('rows').value);
    const hSpace = parseInt(document.getElementById('hSpacing').value);
    const vSpace = parseInt(document.getElementById('vSpacing').value);
    const color = document.getElementById('colorInput').value;
    const font = document.getElementById('fontSelect').value;
    const fontSize = parseInt(document.getElementById('fontSize').value);

    if(!img.src) return alert("اختر صورة أولاً");

    const previewDiv = document.getElementById('preview');
    previewDiv.innerHTML = '';
    let number = startNum;

    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            let canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            let ctx = canvas.getContext('2d');

            function drawImageNumber(){
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.drawImage(img,0,0,img.width,img.height);
                ctx.fillStyle = color;
                ctx.font = `${fontSize}px ${font}`;
                ctx.fillText(toArabicNumber(number), offsetX, offsetY + fontSize);
            }
            drawImageNumber();

            // سحب الرقم داخل النسخة
            let selected=false, startX=0, startY=0;
            canvas.addEventListener('mousedown', e=>{
                const rect = canvas.getBoundingClientRect();
                const mx = e.clientX - rect.left;
                const my = e.clientY - rect.top;
                const width = ctx.measureText(toArabicNumber(number)).width;
                const height = fontSize;
                if(mx>=offsetX && mx<=offsetX+width && my>=offsetY && my<=offsetY+height){
                    selected=true;
                    startX = mx - offsetX;
                    startY = my - offsetY;
                }
            });
            canvas.addEventListener('mousemove', e=>{
                if(selected){
                    const rect = canvas.getBoundingClientRect();
                    offsetX = e.clientX - rect.left - startX;
                    offsetY = e.clientY - rect.top - startY;
                    drawImageNumber();
                }
            });
            canvas.addEventListener('mouseup', ()=> selected=false);
            canvas.addEventListener('mouseout', ()=> selected=false);

            let wrapper = document.createElement('div');
            wrapper.style.display='inline-block';
            wrapper.style.marginRight = hSpace+'px';
            wrapper.style.marginBottom = vSpace+'px';
            wrapper.appendChild(canvas);
            previewDiv.appendChild(wrapper);

            number++;
        }
    }
});

// الطباعة
document.getElementById('printButton').addEventListener('click', ()=>{
    const previewDiv = document.getElementById('preview');
    let printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>الطباعة</title></head><body style="display:flex;flex-wrap:wrap;justify-content:flex-start;margin:0;">');
    Array.from(previewDiv.querySelectorAll('canvas')).forEach(c=>{
        printWindow.document.write(`<img src="${c.toDataURL()}" style="margin-right:10px;margin-bottom:10px;">`);
    });
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
});
</script>

<div id="preview"></div>

</body>
</html>