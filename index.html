<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>بطاقات نافذة A4 مع تحسين حجم الخط وتناسب الصور</title>
<style>
  /* تنسيقات الطباعة */
  @media print {
    body {
      margin: 0;
      padding: 0;
      background: white;
    }
    .grid {
      page-break-inside: avoid;
    }
    .controls, .image-controls {
      display: none !important;
    }
    .card {
      box-shadow: none !important;
    }
    .a4-page {
      box-shadow: none !important;
    }
  }

  /* تنسيقات عامة */
  body {
    font-family: "Tahoma", Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #333;
  }

  .container {
    background: white;
    border-radius: 0;
    box-shadow: none;
    padding: 10px;
    margin-bottom: 10px;
    width: 100%;
    max-width: 210mm;
  }

  h1 {
    color: #1976d2;
    text-align: center;
    margin: 10px 0;
    font-size: 1.5em;
  }

  /* تنسيقات عناصر التحكم */
  .controls, .image-controls {
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .control-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 0;
  }

  .control-group h3 {
    margin: 0;
    width: 100%;
    color: #d32f2f;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;
    font-size: 1em;
  }

  label {
    display: flex;
    flex-direction: column;
    font-weight: bold;
    font-size: 12px;
    min-width: 100px;
  }

  input, button, select {
    padding: 6px 8px;
    font-size: 12px;
    border: 1px solid #ddd;
    border-radius: 2px;
    margin-top: 3px;
    font-family: "Tahoma", Arial, sans-serif;
  }

  input[type="range"] {
    padding: 0;
    margin-top: 5px;
  }

  input[type="file"] {
    padding: 3px;
  }

  button {
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    padding: 8px 10px;
    transition: background 0.3s;
    min-width: 100px;
    font-size: 12px;
  }

  button:hover {
    background: #0d47a1;
  }

  .button-group {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  /* تنسيقات البطاقات */
  .a4-page {
    width: 210mm;
    min-height: 297mm;
    padding: 0;
    background: white;
    box-shadow: none;
    margin: 0 auto;
    box-sizing: border-box;
  }

  .grid {
    display: grid;
    gap: 0;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
  }

  .card {
    border: 1px solid #aaa;
    border-radius: 0;
    padding: 0;
    background: white;
    height: 40mm;
    position: relative;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    box-shadow: none;
    overflow: hidden;
    justify-content: center;
    align-items: center;
    margin: 0;
  }

  .card-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    z-index: 1;
    transition: all 0.3s ease;
    border: none;
    outline: none;
    margin: 0;
  }

  .card-number {
    position: absolute;
    font-weight: bold;
    z-index: 2;
    padding: 0;
    margin: 0;
  }

  .slider-value {
    display: inline-block;
    min-width: 25px;
    text-align: center;
    font-weight: bold;
    font-size: 12px;
  }

  .image-preview {
    max-width: 100%;
    max-height: 120px;
    margin-top: 5px;
    border: 1px dashed #ccc;
    display: none;
  }
</style>
</head>
<body>

<div class="container">
  <h1>بطاقات نافذة A4 مع تحسين حجم الخط وتناسب الصور</h1>
  
  <div class="controls">
    <div class="control-group">
      <h3>الإعدادات الأساسية</h3>
      <label>
        عدد البطاقات
        <input type="number" id="maxNumber" placeholder="عدد البطاقات" min="1" value="6">
      </label>
      
      <label>
        عدد الأعمدة
        <input type="number" id="columns" placeholder="عدد الأعمدة" min="1" value="3">
      </label>
    </div>

    <div class="control-group">
      <h3>إعدادات الرقم</h3>
      <label>
        حجم الرقم
        <input type="range" id="numberSize" min="10" max="70" value="24">
        <span class="slider-value" id="numberSizeValue">24px</span>
      </label>
      
      <label>
        لون الرقم
        <input type="color" id="numberColor" value="#d32f2f">
      </label>
      
      <label>
        موقع الرقم أفقيًا (٪)
        <input type="range" id="numberX" min="0" max="100" value="50">
        <span class="slider-value" id="numberXValue">50%</span>
      </label>
      
      <label>
        موقع الرقم عموديًا (٪)
        <input type="range" id="numberY" min="0" max="100" value="10">
        <span class="slider-value" id="numberYValue">10%</span>
      </label>
    </div>
  </div>
  
  <div class="image-controls">
    <div class="control-group">
      <h3>إعدادات الصورة</h3>
      <label style="width: 100%;">
        اختر صورة للبطاقات
        <input type="file" id="imageUpload" accept="image/*">
        <img id="imagePreview" class="image-preview" alt="معاينة الصورة">
      </label>
      
      <label>
        حجم الصورة (٪)
        <input type="range" id="imageSize" min="10" max="100" value="80">
        <span class="slider-value" id="imageSizeValue">80%</span>
      </label>
      
      <label>
        هامش أفقي (px)
        <input type="range" id="imageMarginX" min="-50" max="50" value="0">
        <span class="slider-value" id="imageMarginXValue">0px</span>
      </label>
      
      <label>
        هامش عمودي (px)
        <input type="range" id="imageMarginY" min="-50" max="50" value="0">
        <span class="slider-value" id="imageMarginYValue">0px</span>
      </label>

      <label>
        <input type="checkbox" id="autoAspectRatio" checked>
        الحفاظ على تناسب الصورة تلقائياً
      </label>
    </div>
  </div>
    
  <div class="button-group">
    <button onclick="generateCards()">إنشاء البطاقات</button>
    <button onclick="window.print()">طباعة البطاقات</button>
    <button onclick="resetSettings()">إعادة التعيين</button>
  </div>
</div>

<div class="a4-page">
  <div class="grid" id="cardsGrid"></div>
</div>

<script>
const grid = document.getElementById("cardsGrid");
let uploadedImage = null;
let imageNaturalWidth = 0;
let imageNaturalHeight = 0;

// دالة لتحويل الأرقام إلى العربية
function toArabicNumbers(num) {
  const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
  return num.toString().replace(/\d/g, digit => arabicNumbers[digit]);
}

// تهيئة القيم عند التحميل
document.addEventListener('DOMContentLoaded', function() {
  // تحديث قيم المتغيرات المنزلقة
  updateSliderValue('numberSize', 'numberSizeValue', 'px');
  updateSliderValue('numberX', 'numberXValue', '%');
  updateSliderValue('numberY', 'numberYValue', '%');
  updateSliderValue('imageSize', 'imageSizeValue', '%');
  updateSliderValue('imageMarginX', 'imageMarginXValue', 'px');
  updateSliderValue('imageMarginY', 'imageMarginYValue', 'px');
  
  // إعداد رفع الصورة
  document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
  
  // إنشاء البطاقات الأولية
  generateCards();
});

// دالة لتحديث عرض قيمة المتغير المنزلق
function updateSliderValue(sliderId, valueId, suffix) {
  const slider = document.getElementById(sliderId);
  const valueElement = document.getElementById(valueId);
  
  // تحديث القيمة الأولية
  valueElement.textContent = slider.value + suffix;
  
  // إضافة مستمع الحدث للتحديث المستمر
  slider.addEventListener('input', function() {
    valueElement.textContent = this.value + suffix;
    generateCards(); // إعادة إنشاء البطاقات عند التغيير
  });
}

// دالة لتحميل الصورة
function handleImageUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  if (!file.type.match('image.*')) {
    alert('الرجاء اختيار ملف صورة فقط');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    uploadedImage = e.target.result;
    
    // الحصول على أبعاد الصورة الأصلية
    const img = new Image();
    img.onload = function() {
      imageNaturalWidth = this.naturalWidth;
      imageNaturalHeight = this.naturalHeight;
      
      document.getElementById('imagePreview').src = uploadedImage;
      document.getElementById('imagePreview').style.display = 'block';
      
      // إنشاء البطاقات تلقائياً بعد تحميل الصورة
      generateCards();
    };
    img.src = uploadedImage;
  };
  reader.readAsDataURL(file);
}

// دالة إنشاء البطاقات
function generateCards() {
  const maxNum = parseInt(document.getElementById("maxNumber").value) || 6;
  const cols = parseInt(document.getElementById("columns").value) || 3;
  const numberSize = parseInt(document.getElementById("numberSize").value) || 24;
  const numberColor = document.getElementById("numberColor").value;
  const numberX = parseInt(document.getElementById("numberX").value) || 50;
  const numberY = parseInt(document.getElementById("numberY").value) || 10;
  const imageSize = parseInt(document.getElementById("imageSize").value) || 80;
  const imageMarginX = parseInt(document.getElementById("imageMarginX").value) || 0;
  const imageMarginY = parseInt(document.getElementById("imageMarginY").value) || 0;
  const autoAspectRatio = document.getElementById("autoAspectRatio").checked;

  // ضبط عدد الأعمدة
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

  // مسح البطاقات القديمة
  grid.innerHTML = '';

  for (let i = 1; i <= maxNum; i++) {
    const card = document.createElement("div");
    card.className = "card";

    // إضافة الصورة إذا تم تحميلها
    if (uploadedImage) {
      const img = document.createElement("img");
      img.className = "card-image";
      img.src = uploadedImage;
      
      // إذا كانت خاصية الحفاظ على التناسب مفعلة وكانت الصورة أطول من عرضها
      if (autoAspectRatio && imageNaturalHeight > imageNaturalWidth) {
        // للصور الطويلة: جعل العرض يتناسب مع الحجم المحدد والطول يتكيف تلقائياً
        img.style.width = `${imageSize}%`;
        img.style.height = 'auto';
      } else {
        // للصور العادية: استخدام الحجم المحدد لكلا البعدين
        img.style.width = `${imageSize}%`;
        img.style.height = `${imageSize}%`;
      }
      
      img.style.marginLeft = `${imageMarginX}px`;
      img.style.marginRight = `${imageMarginX}px`;
      img.style.marginTop = `${imageMarginY}px`;
      img.style.marginBottom = `${imageMarginY}px`;
      card.appendChild(img);
    } else {
      // إذا لم يتم تحميل صورة، عرض رسالة
      const message = document.createElement("div");
      message.textContent = "No image";
      message.style.color = "#999";
      message.style.fontStyle = "italic";
      card.appendChild(message);
    }

    // إضافة الرقم إلى البطاقة (بالعربية)
    const numberElement = document.createElement("div");
    numberElement.className = "card-number";
    numberElement.textContent = toArabicNumbers(i);
    numberElement.style.fontSize = `${numberSize}px`;
    numberElement.style.color = numberColor;
    numberElement.style.left = `${numberX}%`;
    numberElement.style.top = `${numberY}%`;
    numberElement.style.transform = 'translate(-50%, -50%)';
    
    card.appendChild(numberElement);
    grid.appendChild(card);
  }
}

// دالة إعادة تعيين الإعدادات
function resetSettings() {
  document.getElementById("maxNumber").value = 6;
  document.getElementById("columns").value = 3;
  document.getElementById("numberSize").value = 24;
  document.getElementById("numberColor").value = "#d32f2f";
  document.getElementById("numberX").value = 50;
  document.getElementById("numberY").value = 10;
  document.getElementById("imageSize").value = 80;
  document.getElementById("imageMarginX").value = 0;
  document.getElementById("imageMarginY").value = 0;
  document.getElementById("autoAspectRatio").checked = true;
  
  // تحديث قيم المتغيرات المنزلقة المعروضة
  document.getElementById("numberSizeValue").textContent = "24px";
  document.getElementById("numberXValue").textContent = "50%";
  document.getElementById("numberYValue").textContent = "10%";
  document.getElementById("imageSizeValue").textContent = "80%";
  document.getElementById("imageMarginXValue").textContent = "0px";
  document.getElementById("imageMarginYValue").textContent = "0px";
  
  // إعادة تعيين الصورة
  uploadedImage = null;
  imageNaturalWidth = 0;
  imageNaturalHeight = 0;
  document.getElementById("imageUpload").value = "";
  document.getElementById("imagePreview").style.display = "none";
  
  generateCards();
}

// إضافة مستمعي الأحداث للتحكم الفوري
document.getElementById('numberSize').addEventListener('input', generateCards);
document.getElementById('numberColor').addEventListener('input', generateCards);
document.getElementById('numberX').addEventListener('input', generateCards);
document.getElementById('numberY').addEventListener('input', generateCards);
document.getElementById('imageSize').addEventListener('input', generateCards);
document.getElementById('imageMarginX').addEventListener('input', generateCards);
document.getElementById('imageMarginY').addEventListener('input', generateCards);
document.getElementById('autoAspectRatio').addEventListener('change', generateCards);
document.getElementById('maxNumber').addEventListener('input', generateCards);
document.getElementById('columns').addEventListener('input', generateCards);
</script>

</body>
</html>