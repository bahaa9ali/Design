<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>بطاقات نافذة A4 مع التحكم في الهوامش الداخلية</title>
<style>
  /* تنسيقات الطباعة */
  @media print {
    body, html {
      margin: 0 !important;
      padding: 0 !important;
      background: white !important;
      width: 100% !important;
      height: 100% !important;
    }
    
    .grid {
      page-break-inside: avoid;
      display: grid !important;
      gap: 5mm !important;
    }
    
    .controls, .image-controls, .container, .button-group, h1, .print-warning {
      display: none !important;
    }
    
    .card {
      box-shadow: none !important;
      border: 1px solid #ccc !important;
      padding: 0 !important;
      margin: 0 !important;
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      position: relative !important;
      page-break-inside: avoid !important;
    }
    
    .a4-page {
      box-shadow: none !important;
      padding: 0 !important;
      margin: 0 !important;
      width: 210mm !important;
      min-height: 297mm !important;
      display: block !important;
    }
    
    .card-number {
      color: black !important;
      font-weight: bold !important;
      position: absolute !important;
      background: transparent !important;
      padding: 0 !important;
      margin: 0 !important;
      text-shadow: none !important;
      box-shadow: none !important;
    }
    
    .card-image {
      max-width: 80% !important;
      max-height: 80% !important;
      object-fit: contain !important;
    }
  }

  /* تنسيقات عامة */
  body {
    font-family: "Tahoma", Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #333;
  }

  .container {
    background: white;
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    padding: 15px;
    margin-bottom: 15px;
    width: 100%;
    max-width: 210mm;
  }

  h1 {
    color: #1976d2;
    text-align: center;
    margin: 10px 0 20px 0;
    font-size: 1.5em;
  }

  /* تنسيقات عناصر التحكم */
  .controls, .image-controls {
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .control-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 5px;
  }

  .control-group h3 {
    margin: 0;
    width: 100%;
    color: #d32f2f;
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px;
    font-size: 1.1em;
  }

  label {
    display: flex;
    flex-direction: column;
    font-weight: bold;
    font-size: 13px;
    min-width: 120px;
  }

  input, button, select {
    padding: 8px 10px;
    font-size: 13px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-top: 5px;
    font-family: "Tahoma", Arial, sans-serif;
  }

  input[type="range"] {
    padding: 0;
    margin-top: 8px;
  }

  input[type="file"] {
    padding: 5px;
  }

  button {
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    padding: 10px 15px;
    transition: background 0.3s;
    min-width: 120px;
    font-size: 13px;
  }

  button:hover {
    background: #0d47a1;
  }

  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 10px;
  }

  /* تنسيقات البطاقات */
  .a4-page {
    width: 210mm;
    min-height: 297mm;
    padding: 10mm;
    background: white;
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
    margin: 0 auto;
    box-sizing: border-box;
  }

  .grid {
    display: grid;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    gap: 5mm;
  }

  .card {
    border: 1px solid #ddd;
    background: white;
    position: relative;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 5mm;
    transition: padding 0.3s ease;
  }

  .card-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    z-index: 1;
    transition: all 0.3s ease;
    border: none;
    outline: none;
    margin: 0;
  }

  .card-number {
    position: absolute;
    font-weight: bold;
    z-index: 2;
    color: #d32f2f;
    text-shadow: none;
    box-shadow: none;
    background: transparent;
  }

  .slider-value {
    display: inline-block;
    min-width: 30px;
    text-align: center;
    font-weight: bold;
    font-size: 13px;
  }

  .image-preview {
    max-width: 100%;
    max-height: 150px;
    margin-top: 8px;
    border: 1px dashed #ccc;
    display: none;
  }

  .dimensions-info {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
    text-align: center;
  }
  
  .print-warning {
    color: #d32f2f;
    text-align: center;
    font-size: 14px;
    margin-top: 10px;
    padding: 10px;
    background: #fff8e1;
    border-radius: 4px;
    border: 1px dashed #ffd54f;
  }
  
  .margin-control {
    background: #e3f2fd;
    border-left: 4px solid #1976d2;
  }
  
  .margin-preview {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 4px;
    font-size: 13px;
  }
  
  .margin-preview span {
    font-weight: bold;
    color: #1976d2;
  }
</style>
</head>
<body>

<div class="container">
  <h1>بطاقات نافذة A4 مع التحكم في الهوامش الداخلية</h1>
  
  <div class="print-warning">
    تأكد من تعيين هوامش الطباعة على "الافتراضي" أو "بلا هوامش" في إعدادات الطباعة للحصول على أفضل نتيجة.
  </div>
  
  <div class="controls">
    <div class="control-group">
      <h3>الإعدادات الأساسية</h3>
      <label>
        عدد الأعمدة
        <input type="number" id="columns" placeholder="عدد الأعمدة" min="1" max="10" value="3">
      </label>
      
      <label>
        عدد الصفوف
        <input type="number" id="rows" placeholder="عدد الصفوف" min="1" max="10" value="2">
      </label>
      
      <label>
        المسافة بين البطاقات (مم)
        <input type="number" id="gap" placeholder="المسافة" min="0" max="20" value="5">
      </label>
    </div>

    <div class="control-group margin-control">
      <h3>هوامش البطاقات الداخلية (مم)</h3>
      <label>
        الهامش الداخلي للبطاقة
        <input type="range" id="cardPadding" min="0" max="20" value="5">
        <span class="slider-value" id="cardPaddingValue">5mm</span>
      </label>
      
      <label>
        هامش الصورة الأفقي (٪)
        <input type="range" id="imageMarginX" min="0" max="20" value="0">
        <span class="slider-value" id="imageMarginXValue">0%</span>
      </label>
      
      <label>
        هامش الصورة العمودي (٪)
        <input type="range" id="imageMarginY" min="0" max="20" value="0">
        <span class="slider-value" id="imageMarginYValue">0%</span>
      </label>
      
      <div class="margin-preview">
        <div>الهوامش الحالية: <span id="currentMargins">5mm (بطاقة) - 0% (صورة)</span></div>
      </div>
    </div>

    <div class="control-group">
      <h3>إعدادات الرقم</h3>
      <label>
        حجم الرقم
        <input type="range" id="numberSize" min="10" max="70" value="24">
        <span class="slider-value" id="numberSizeValue">24px</span>
      </label>
      
      <label>
        لون الرقم
        <input type="color" id="numberColor" value="#d32f2f">
      </label>
      
      <label>
        موقع الرقم أفقيًا (٪)
        <input type="range" id="numberX" min="0" max="100" value="50">
        <span class="slider-value" id="numberXValue">50%</span>
      </label>
      
      <label>
        موقع الرقم عموديًا (٪)
        <input type="range" id="numberY" min="0" max="100" value="10">
        <span class="slider-value" id="numberYValue">10%</span>
      </label>
    </div>
  </div>
  
  <div class="image-controls">
    <div class="control-group">
      <h3>إعدادات الصورة</h3>
      <label style="width: 100%;">
        اختر صورة للبطاقات
        <input type="file" id="imageUpload" accept="image/*">
        <img id="imagePreview" class="image-preview" alt="معاينة الصورة">
        <div id="imageDimensions" class="dimensions-info"></div>
      </label>
      
      <label>
        حجم الصورة (٪)
        <input type="range" id="imageSize" min="10" max="100" value="80">
        <span class="slider-value" id="imageSizeValue">80%</span>
      </label>

      <label>
        <input type="checkbox" id="autoAspectRatio" checked>
        الحفاظ على تناسب الصورة تلقائياً
      </label>
    </div>
  </div>
    
  <div class="button-group">
    <button onclick="generateCards()">إنشاء البطاقات</button>
    <button onclick="printCards()">طباعة البطاقات</button>
    <button onclick="resetSettings()">إعادة التعيين</button>
  </div>
</div>

<div class="a4-page" id="a4Page">
  <div class="grid" id="cardsGrid"></div>
</div>

<script>
const grid = document.getElementById("cardsGrid");
const a4Page = document.getElementById("a4Page");
let uploadedImage = null;
let imageNaturalWidth = 0;
let imageNaturalHeight = 0;

// دالة لتحويل الأرقام إلى العربية
function toArabicNumbers(num) {
  const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
  return num.toString().replace(/\d/g, digit => arabicNumbers[digit]);
}

// دالة للطباعة
function printCards() {
  window.print();
}

// تحديث هوامش البطاقات
function updateCardMargins() {
  const cardPadding = document.getElementById("cardPadding").value;
  const imageMarginX = document.getElementById("imageMarginX").value;
  const imageMarginY = document.getElementById("imageMarginY").value;
  
  // تطبيق الهوامش على جميع البطاقات
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.style.padding = `${cardPadding}mm`;
  });
  
  // تطبيق هوامش الصورة
  const images = document.querySelectorAll('.card-image');
  images.forEach(img => {
    img.style.marginLeft = `${imageMarginX}%`;
    img.style.marginRight = `${imageMarginX}%`;
    img.style.marginTop = `${imageMarginY}%`;
    img.style.marginBottom = `${imageMarginY}%`;
  });
  
  // تحديث عرض الهوامش الحالية
  document.getElementById("currentMargins").textContent = 
    `${cardPadding}mm (بطاقة) - ${imageMarginX}% (صورة)`;
  
  // تحديث تنسيقات الطباعة
  updatePrintStyles();
}

// تحديث تنسيقات الطباعة
function updatePrintStyles() {
  const cols = parseInt(document.getElementById("columns").value) || 3;
  const gap = parseInt(document.getElementById("gap").value) || 5;
  const cardPadding = document.getElementById("cardPadding").value;
  
  // إنشاء أو تحديث نمط الطباعة
  let printStyle = document.getElementById('printStyles');
  if (!printStyle) {
    printStyle = document.createElement('style');
    printStyle.id = 'printStyles';
    document.head.appendChild(printStyle);
  }
  
  printStyle.textContent = `
    @media print {
      .grid {
        grid-template-columns: repeat(${cols}, 1fr) !important;
        gap: ${gap}mm !important;
      }
      .card {
        padding: ${cardPadding}mm !important;
      }
    }
  `;
}

// تهيئة القيم عند التحميل
document.addEventListener('DOMContentLoaded', function() {
  // تحديث قيم المتغيرات المنزلقة
  updateSliderValue('numberSize', 'numberSizeValue', 'px');
  updateSliderValue('numberX', 'numberXValue', '%');
  updateSliderValue('numberY', 'numberYValue', '%');
  updateSliderValue('imageSize', 'imageSizeValue', '%');
  updateSliderValue('cardPadding', 'cardPaddingValue', 'mm');
  updateSliderValue('imageMarginX', 'imageMarginXValue', '%');
  updateSliderValue('imageMarginY', 'imageMarginYValue', '%');
  
  // إعداد رفع الصورة
  document.getElementById('imageUpload').addEventListener('change', handleImageUpload);
  
  // إضافة مستمعي الأحداث للحقول الرقمية
  document.getElementById('columns').addEventListener('input', function() {
    generateCards();
    updatePrintStyles();
  });
  document.getElementById('rows').addEventListener('input', generateCards);
  document.getElementById('gap').addEventListener('input', function() {
    grid.style.gap = `${this.value}mm`;
    updatePrintStyles();
  });
  
  // إضافة مستمعي الأحداث لهوامش البطاقات
  document.getElementById('cardPadding').addEventListener('input', updateCardMargins);
  document.getElementById('imageMarginX').addEventListener('input', updateCardMargins);
  document.getElementById('imageMarginY').addEventListener('input', updateCardMargins);
  
  // إنشاء البطاقات الأولية وتحديث الهوامش
  generateCards();
  updateCardMargins();
  updatePrintStyles();
});

// دالة لتحديث عرض قيمة المتغير المنزلق
function updateSliderValue(sliderId, valueId, suffix) {
  const slider = document.getElementById(sliderId);
  const valueElement = document.getElementById(valueId);
  
  // تحديث القيمة الأولية
  valueElement.textContent = slider.value + suffix;
  
  // إضافة مستمع الحدث للتحديث المستمر
  slider.addEventListener('input', function() {
    valueElement.textContent = this.value + suffix;
    
    // إذا كان المنزلق خاص بالهوامش، قم بتحديث الهوامش
    if (sliderId.includes('margin') || sliderId.includes('Padding')) {
      updateCardMargins();
    } else if (sliderId.includes('gap') || sliderId.includes('columns')) {
      updatePrintStyles();
    } else {
      generateCards();
    }
  });
}

// دالة لتحميل الصورة
function handleImageUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  if (!file.type.match('image.*')) {
    alert('الرجاء اختيار ملف صورة فقط');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    uploadedImage = e.target.result;
    
    // الحصول على أبعاد الصورة الأصلية
    const img = new Image();
    img.onload = function() {
      imageNaturalWidth = this.naturalWidth;
      imageNaturalHeight = this.naturalHeight;
      
      // عرض معلومات الأبعاد
      document.getElementById('imageDimensions').textContent = 
        `أبعاد الصورة: ${imageNaturalWidth} × ${imageNaturalHeight} بكسل`;
      
      document.getElementById('imagePreview').src = uploadedImage;
      document.getElementById('imagePreview').style.display = 'block';
      
      // إنشاء البطاقات تلقائياً بعد تحميل الصورة
      generateCards();
      updateCardMargins();
    };
    img.src = uploadedImage;
  };
  reader.readAsDataURL(file);
}

// دالة إنشاء البطاقات
function generateCards() {
  const cols = parseInt(document.getElementById("columns").value) || 3;
  const rows = parseInt(document.getElementById("rows").value) || 2;
  const gap = parseInt(document.getElementById("gap").value) || 5;
  const numberSize = parseInt(document.getElementById("numberSize").value) || 24;
  const numberColor = document.getElementById("numberColor").value;
  const numberX = parseInt(document.getElementById("numberX").value) || 50;
  const numberY = parseInt(document.getElementById("numberY").value) || 10;
  const imageSize = parseInt(document.getElementById("imageSize").value) || 80;
  const autoAspectRatio = document.getElementById("autoAspectRatio").checked;

  // حساب عدد البطاقات الإجمالي
  const totalCards = cols * rows;
  
  // ضبط عدد الأعمدة والمسافات
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  grid.style.gap = `${gap}mm`;

  // مسح البطاقات القديمة
  grid.innerHTML = '';

  let cardCounter = 1;
  
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
      const card = document.createElement("div");
      card.className = "card";

      // إضافة الصورة إذا تم تحميلها
      if (uploadedImage) {
        const img = document.createElement("img");
        img.className = "card-image";
        img.src = uploadedImage;
        
        // إذا كانت خاصية الحفاظ على التناسب مفعلة وكانت الصورة أطول من عرضها
        if (autoAspectRatio && imageNaturalHeight > imageNaturalWidth) {
          // للصور الطويلة: جعل العرض يتناسب مع الحجم المحدد والطول يتكيف تلقائياً
          img.style.width = `${imageSize}%`;
          img.style.height = 'auto';
        } else {
          // للصور العادية: استخدام الحجم المحدد لكلا البعدين
          img.style.width = `${imageSize}%`;
          img.style.height = `${imageSize}%`;
        }
        
        card.appendChild(img);
      } else {
        // إذا لم يتم تحميل صورة، عرض رسالة
        const message = document.createElement("div");
        message.textContent = "No image";
        message.style.color = "#999";
        message.style.fontStyle = "italic";
        card.appendChild(message);
      }

      // إضافة الرقم إلى البطاقة (بالعربية)
      const numberElement = document.createElement("div");
      numberElement.className = "card-number";
      numberElement.textContent = toArabicNumbers(cardCounter);
      numberElement.style.fontSize = `${numberSize}px`;
      numberElement.style.color = numberColor;
      numberElement.style.left = `${numberX}%`;
      numberElement.style.top = `${numberY}%`;
      numberElement.style.transform = 'translate(-50%, -50%)';
      
      card.appendChild(numberElement);
      grid.appendChild(card);
      
      cardCounter++;
    }
  }
  
  // تطبيق الهوامش بعد إنشاء البطاقات
  updateCardMargins();
}

// دالة إعادة تعيين الإعدادات
function resetSettings() {
  document.getElementById("columns").value = 3;
  document.getElementById("rows").value = 2;
  document.getElementById("gap").value = 5;
  document.getElementById("numberSize").value = 24;
  document.getElementById("numberColor").value = "#d32f2f";
  document.getElementById("numberX").value = 50;
  document.getElementById("numberY").value = 10;
  document.getElementById("imageSize").value = 80;
  document.getElementById("autoAspectRatio").checked = true;
  
  // إعادة تعيين الهوامش
  document.getElementById("cardPadding").value = 5;
  document.getElementById("imageMarginX").value = 0;
  document.getElementById("imageMarginY").value = 0;
  
  // تحديث قيم المتغيرات المنزلقة المعروضة
  document.getElementById("numberSizeValue").textContent = "24px";
  document.getElementById("numberXValue").textContent = "50%";
  document.getElementById("numberYValue").textContent = "10%";
  document.getElementById("imageSizeValue").textContent = "80%";
  document.getElementById("cardPaddingValue").textContent = "5mm";
  document.getElementById("imageMarginXValue").textContent = "0%";
  document.getElementById("imageMarginYValue").textContent = "0%";
  
  // إعادة تعيين الصورة
  uploadedImage = null;
  imageNaturalWidth = 0;
  imageNaturalHeight = 0;
  document.getElementById("imageUpload").value = "";
  document.getElementById("imagePreview").style.display = "none";
  document.getElementById("imageDimensions").textContent = "";
  
  generateCards();
  updateCardMargins();
  updatePrintStyles();
}

// إضافة مستمعي الأحداث للتحكم الفوري
document.getElementById('numberSize').addEventListener('input', generateCards);
document.getElementById('numberColor').addEventListener('input', generateCards);
document.getElementById('numberX').addEventListener('input', generateCards);
document.getElementById('numberY').addEventListener('input', generateCards);
document.getElementById('imageSize').addEventListener('input', generateCards);
document.getElementById('autoAspectRatio').addEventListener('change', generateCards);
</script>

</body>
</html>